<%- include('includes/header.ejs') %>
<%- include('includes/sidebar.ejs') %>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<div id="Ticket" style="color:black">
  <!-- The Modal -->
    <div class="modal fade" id="myModal">
        <div class="modal-dialog modal-lg">
           <div class="modal-content">
  <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title"> Asunto: <span id="asunto"></span> Ticket # <span id="id_ticket"> </span> </h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

  <!-- Modal body -->
                <div class="modal-body">
                    <form id="modify_ticket" method="POST">
                        <input type="hidden" name="_csrf" id="_csrf" value="<%= csrfToken %>"></input>
                        <input type="hidden" name="Id_Ticket" id="Id_Ticket" value="">

                        <div class="row">
                            <div class="col-xxl-2">
                                <h6 style="text-align: left;">Tipo Incidencia</h6>
                            </div>
                            <div class="col">
                                <select class="form-select" id="select_tipo_incidencia" name="select_tipo_incidencia" aria-label="Default select example">
                                    <% for (let incidencia of incidencias){%>
                                        <option selected="false" value="<%=incidencia.Id_Tipo_Incidencia%>" id="tipo_incidencia<%= incidencia.Id_Tipo_Incidencia %>"> <%=incidencia.Nombre_Tipo_Incidencia%> </option>
                                    <%}%>
                                </select>
                            </div>
                        </div>

                        <br>
                        
                        <div class="row">       
                            <div class="col-xxl-2">
                                <h6 style="text-align: left;">Estado</h6>
                            </div>
                            <div class="col">
                                <select class="form-select" id="select_estado" name="estado" aria-label="Default select example">
                                    <% for (let estado of estados){%>
                                        <option selected="false" value="<%=estado.Id_Estado%>" id="estado<%=estado.Id_Estado%>"> <%=estado.Nombre_Estado %> </option>
                                    <%}%>
                                    <input type="hidden" name="Estado_Actual" id="Estado_Actual" value="">
                                </select>
                            </div>


                             <div class="col-xxl-2">
                                <h6 style="text-align: left;">Prioridad</h6>
                            </div>
                            <div class="col">
                                <select class="form-select" id="select_prioridad" name="prioridad" aria-label="Default select example">
                                    <% for (let prioridad of prioridades){%>
                                        <option selected="false" value="<%=prioridad.Id_Prioridad%>" id="prioridad<%= prioridad.Id_Prioridad %>"> <%=prioridad.Nombre_Prioridad %> </option>
                                    <%}%>
                                </select>
                            </div>

                        </div>
                                
                        <br>


                        <h6>Descripción: </h6>
                            <p class="border-primary" id="descripcion"  style="border-radius: 18px;padding: 0px;border-right: 0px solid rgb(0,0,0);">
                            </p>

                        <br>

                        <h6>Preguntas:  </h6>
               
                            <div class="row">
                                <div class="row" id="preguntas">
                                    </div>
                                    <div class="row" id="preguntas_nuevas">
                                        </div>
                                        <input type="hidden" id="numPreguntas" name="numPreguntas" value="0">
                                    </div>
                            

                                <div class="row">


                                    <div class="col"><button type="button" class="btn btn-primary" id="enviar"
                                            type="button"
                                            style="background: rgb(0,0,0);width: 100%;margin-top: 40px;">Actualizar<i
                                                class="fa fa-refresh" style="margin-left: 15px;"></i></button></div>
                                    <div class="col"><button class="btn btn-primary" id="boton_comentarios"
                                            type="button"
                                            style="background: rgb(0,0,0);width: 100%;margin-top: 40px;">Comentarios<i
                                                class="fa fa-comments-o" style="margin-left: 15px;"></i></button></div>
                                    <div class="col"><button class="btn btn-primary" type="button"
                                            style="background: rgb(0,0,0);width: 100%;margin-top: 40px;">Asignación<i
                                                class="fa fa-user-plus" style="margin-left: 15px;"></i></button></div>
                                    
                                </div>

                                


                            </form>

                        </div>


                    

                        <div id="commentShow" style="display:none;" class="modal-body">
                            
                                <div >
                                    <div class="row d-flex justify-content-center">
                                        <div class="col">
                                            <div class="card shadow-0 border" style="background-color: #f0f2f5;">
                                                <div class="card-body p-4">
                                                    <div class="form-outline mb-4">
                                                        <!-- <form id="nuevo_comentario" method="POST" enctype="multipart/form-data"> -->
                                                            <input type="hidden" name="_csrf" id="_csrf" value="<%= csrfToken %>"></input>
                                                            <label for="comment">Comentario: </label>
                                                            <input id="id_ticket" name="id_ticket" type="hidden" value="">
                                                            <input type="text" id="texto_comentario" name="texto_comentario" placeholder="Escribe aqui...">
                                                        
                                                            <button onClick="submitForm()"  type="button" class="btn btn-success" id="Agregar"> Agregar Comentario </button>
                                                            <input type="file" id="url_archivo_comentario" name="url_archivo_comentario">
                                                            <script>
                                                                var input = document.getElementById("texto_comentario");
                                                                input.addEventListener("keyup", function(event) {
                                                                if (event.keyCode === 13) {
                                                                event.preventDefault();
                                                                console.log("hi");
                                                                document.getElementById("Agregar").click();
                                                                }
                                                                });
                                                            </script> 
                                                        <!-- </form> -->
                                                                                            
                                                    </div> <div id="comentarios"></div>    
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>                       
                            </div>
                        </div>
                    
                </div>
            </div>

            <div class="page-content-wrapper" style="color: var(--bs-teal);">
                <div class="container-fluid" style="color: transparent;background: var(--bs-indigo);">
                    <div class="row" style="background: var(--bs-red);">
                        <div class="col-sm-12 offset-2 offset-sm-1 offset-md-0 offset-lg-0 offset-xl-0 offset-xxl-0"
                            style="color: var(--bs-purple);background: #FF595A;">
                            <div></div>
                            <h1 style="color: var(--bs-body-bg);margin-left: 50px;">Panel Tickets</h1>
                        </div>
                    </div>
                </div>
                <div class="container">
                    <div class="row" style="margin-top: 30px;">
                        <% for(let ticket of tickets) {%>

                            <div  onClick="openTicket(this)" data-bs-toggle="modal" data-bs-target="#myModal"
                                id="boton<%= ticket.Id_Ticket %>" class="col" style="cursor:pointer;margin-bottom:20px;">
                                <div class="card h-100"
                                    style="overflow: hidden;margin-top:10px;margin-bottom:10px;box-shadow: 1px 4px 8px rgba(0,0,0,0.46);">
                                    <div class="card-body" style="text-align: left;width: 262px;overflow: hidden;">
                                        <h4 class="card-title"
                                            style="overflow: hidden;color: rgb(0,0,0);text-align: left;">Ticket <%=
                                                ticket.Id_Ticket %>
                                        </h4>
                                        <h6 class="text-muted card-subtitle mb-2"
                                            style="overflow: hidden;color: rgb(0,0,0);">
                                            <%= ticket.Asunto %>
                                        </h6>
                                        <i class="fa fa-circle"
                                            style="overflow: hidden;color: rgb(159,159,159);"></i>
                                            <span
                                            style="overflow: hidden;margin-left: 10px;color: rgb(136,136,136);">Creado
                                            el <%= ticket.Fecha_Inicio %></span>
                                            
                                            <!-- <img class="rounded-circle"
                                            style="width: 35px;height: 35px;margin-left: 15px;"
                                            src="/img/WhatsApp%20Image%202021-12-02%20at%206.30.57%20AM.jpeg"> -->

                                    </div>
                                </div>
                            </div>
                            <% }%>
                    </div>
                </div>
            </div>




            <script src="/js/script_popup_ticket.js"></script>
            <%- include('includes/foot.ejs') %>